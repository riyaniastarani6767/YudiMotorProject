{% extends "base.html" %}
{% set title = "Home • YudiMotor" %}
{% block content %}

<style>
 
  #homePage .obj-4x3{
    width:100%;
    aspect-ratio: 4/3 !important;   /* override aturan global 3/4 */
    object-fit: cover;
    height:auto !important;           /* jaga proporsi */
    border-top-left-radius:.75rem;
    border-top-right-radius:.75rem;
  }

  /* Slider rapi */
  #homePage .track{ display:flex; gap:.75rem; overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior: smooth; }
  #homePage .product-card{ min-width:240px; scroll-snap-align:start; cursor: pointer; }
  
  /* Modal Styling */
  .modal-backdrop { background-color: rgba(0,0,0,0.5); }
  .modal-body img { max-height: 400px; object-fit: contain; }

  /* Mobile Kecil (< 576px) */
@media (max-width: 576px) {
  /* Hero */
  #homePage .hero h1 { font-size: 1.5rem; }
  #homePage .hero p { font-size: 0.9rem; }
  
  /* Slider produk lebih kecil di mobile */
  #homePage .product-card { 
    min-width: 180px; 
  }
  
  /* Hide tombol scroll di mobile (bisa swipe) */
  #btnScrollLeft, #btnScrollRight { 
    display: none; 
  }
  
  /* USP Cards lebih compact */
  .usp-card { 
    padding: 0.75rem;
    font-size: 0.9rem; 
  }
  .usp-card i { 
    font-size: 1.5rem !important; 
  }
  
  /* Modal image lebih kecil */
  .modal-body img { 
    max-height: 250px; 
  }
  
  /* Maps lebih pendek di mobile */
  .ratio-16x9 { 
    aspect-ratio: 4/3; 
  }
}

/* Tablet (576px - 991px) */
@media (min-width: 576px) and (max-width: 991px) {
  #homePage .product-card { 
    min-width: 220px; 
  }
  
  /* Tampilkan tombol scroll */
  #btnScrollLeft, #btnScrollRight { 
    display: inline-block; 
  }
}

/* Desktop (> 992px) */
@media (min-width: 992px) {
  #homePage .product-card { 
    min-width: 260px; 
  }
  
  /* Maps 16:9 untuk desktop */
  .ratio-16x9 { 
    aspect-ratio: 16/9; 
  }
}

/* Touch devices - perbaiki scrolling */
@media (hover: none) and (pointer: coarse) {
  #homePage .track {
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
  }
  
  #homePage .track::-webkit-scrollbar {
    display: none; /* Chrome, Safari */
  }
}
</style>

<div id="homePage">
  <section class="hero">
    <div class="container py-5 text-white">
      <h1 class="fw-bold">Selamat Datang di Yudi Motor</h1>
      <p class="mb-0">Temukan berbagai ban, oli, aki, dan produk pilihan lainnya untuk kendaraan Anda.</p>
    </div>
  </section>

  <!-- Keunggulan -->
  <section class="py-4">
    <div class="container">
      <div class="row g-3">
        <div class="col-12 col-md-6 col-lg-4"><div class="usp-card">
          <i class="bi bi-wrench fs-2"></i><div><h6 class="mb-1">Layanan Terpercaya</h6><div class="small opacity-75">Ditangani oleh ahli berpengalaman</div></div>
        </div></div>
        <div class="col-12 col-md-6 col-lg-4"><div class="usp-card">
          <i class="bi bi-shield-check fs-2"></i><div><h6 class="mb-1">Gratis Pemasangan Ban</h6><div class="small opacity-75">Untuk setiap pembelian ban di YudiMotor.</div></div>
        </div></div>
        <div class="col-12 col-md-6 col-lg-4"><div class="usp-card">
          <i class="bi bi-chat-dots fs-2"></i><div><h6 class="mb-1">Konsultasi Gratis</h6><div class="small opacity-75">Dapatkan rekomendasi terbaik dari kami.</div></div>
        </div></div>
      </div>
    </div>
  </section>

  <!-- Produk Unggulan (slider) -->
  <div class="container my-2">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Produk Unggulan</h5>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-dark btn-sm" id="btnScrollLeft"><i class="bi bi-chevron-left"></i></button>
        <button class="btn btn-outline-dark btn-sm" id="btnScrollRight"><i class="bi bi-chevron-right"></i></button>
      </div>
    </div>
    <div id="track" class="track">
      {% for p in products_home %}
      <div class="card product-card"
           data-name="{{ p.name }}" data-category="{{ p.category }}" data-price="{{ p.price }}"
           data-image="{{ url_for('static', filename='images/' + p.image) }}" 
           data-desc="{{ p.desc or '' }}"
           data-spesifikasi="{{ p.spesifikasi_motor or '' }}">
        <img src="{{ url_for('static', filename='images/' + p.image) }}" class="card-img-top obj-4x3" alt="{{ p.name }}">
        <div class="card-body">
          <h6 class="card-title text-truncate" title="{{ p.name }}">{{ p.name }}</h6>
          <p class="card-text mb-2 text-muted small">{{ p.category }}</p>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Rp {{ "{:,.0f}".format(p.price) if p.price is number else p.price | replace(",", ".") }}</span>
            <button class="btn btn-sm btn-dark btn-detail">Detail</button>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Preview Produk -->
  <div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Beberapa Produk</h5>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('products_page') }}">Lihat semua</a>
    </div>
    <div class="row g-3 row-cols-1 row-cols-sm-2 row-cols-lg-3">
      {% for p in products_home[:6] %}
      <div class="col product-col"
           data-name="{{ p.name }}" data-category="{{ p.category }}" data-price="{{ p.price }}"
           data-image="{{ url_for('static', filename='images/' + p.image) }}" 
           data-desc="{{ p.desc or '' }}"
           data-spesifikasi="{{ p.spesifikasi_motor or '' }}">
        <div class="card h-100">
          <img src="{{ url_for('static', filename='images/' + p.image) }}" class="card-img-top obj-4x3" alt="{{ p.name }}">
          <div class="card-body d-flex flex-column">
            <h6 class="text-truncate" title="{{ p.name }}">{{ p.name }}</h6>
            <p class="small text-muted mb-2">{{ p.category }}</p>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <span class="fw-semibold">Rp {{ "{:,.0f}".format(p.price) if p.price is number else p.price | replace(",", ".") }}</span>
              <button class="btn btn-sm btn-dark btn-detail">Beli</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Lokasi & Jam -->
  <section class="py-4 bg-light">
    <div class="container">
      <h5 class="mb-3">Lokasi & Jam Buka</h5>
      <div class="row g-3 align-items-stretch">
        <div class="col-lg-7">
          <div class="ratio ratio-16x9 rounded overflow-hidden shadow-sm">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3944.1328924292555!2d115.1654827757881!3d-8.675995391377724!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2dd23b8bfe813f49%3A0x2b9e2ea67163b866!2sYudi%20Motor!5e0!3m2!1sid!2sid!4v1731395900000!5m2!1sid!2sid"
              style="border:0" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          </div>
        </div>
        <div class="col-lg-5 order-lg-last">
          <div class="p-3 bg-white rounded shadow-sm small h-100">
            <div class="mb-2"><strong>YudiMotor</strong></div>
            <div>Senin–Minggu: 07.00–21.00</div><div></div>
            <hr>
            <a class="btn btn-success w-100" target="_blank" href="https://wa.me/6285738506679">
              <i class="bi bi-whatsapp me-1"></i> Chat WhatsApp
            </a>
            <a class="btn btn-outline-secondary w-100 mt-2" target="_blank" href="https://maps.app.goo.gl/uFKZbshVpHpEnHkB9">
              Lihat di Google Maps
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Modal Detail Produk -->
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productModalLabel">Detail Produk</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <img id="modalImage" src="" alt="" class="img-fluid rounded">
        </div>
        <h5 id="modalName" class="fw-bold"></h5>
        <p class="text-muted mb-2"><small id="modalCategory"></small></p>
        <h4 class="text-primary mb-3" id="modalPrice"></h4>
        
        <div id="modalDesc" class="mb-3"></div>
        <div id="modalSpesifikasi" class="mb-3"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-success" id="btnOrderWA">
          <i class="bi bi-whatsapp me-1"></i> Pesan via WhatsApp
        </button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Fungsi untuk scroll slider
  const track = document.getElementById('track');
  const btnScrollLeft = document.getElementById('btnScrollLeft');
  const btnScrollRight = document.getElementById('btnScrollRight');
  
  if (btnScrollLeft && track) {
    btnScrollLeft.addEventListener('click', function() {
      track.scrollBy({ left: -300, behavior: 'smooth' });
    });
  }
  
  if (btnScrollRight && track) {
    btnScrollRight.addEventListener('click', function() {
      track.scrollBy({ left: 300, behavior: 'smooth' });
    });
  }
  
  // Inisialisasi Bootstrap Modal
  const productModal = new bootstrap.Modal(document.getElementById('productModal'));
  let currentProductData = null;
  
  // Fungsi untuk menampilkan modal dengan data produk
  function showProductModal(productData) {
    currentProductData = productData;
    
    document.getElementById('modalImage').src = productData.image;
    document.getElementById('modalName').textContent = productData.name;
    document.getElementById('modalCategory').textContent = productData.category;
    
    // Format harga
    let priceText = '';
    if (productData.price.includes('-')) {
      priceText = 'Rp ' + productData.price.replace(',', '.');
    } else {
      priceText = 'Rp ' + parseInt(productData.price).toLocaleString('id-ID');
    }
    document.getElementById('modalPrice').textContent = priceText;
    
    // Deskripsi
    const descEl = document.getElementById('modalDesc');
    if (productData.desc) {
      descEl.innerHTML = '<strong>Deskripsi:</strong><br>' + productData.desc.replace(/\n/g, '<br>');
      descEl.style.display = 'block';
    } else {
      descEl.style.display = 'none';
    }
    
    // Spesifikasi Motor
    const spesifikasiEl = document.getElementById('modalSpesifikasi');
    if (productData.spesifikasi) {
      spesifikasiEl.innerHTML = '<strong>Cocok untuk motor:</strong><br>' + productData.spesifikasi;
      spesifikasiEl.style.display = 'block';
    } else {
      spesifikasiEl.style.display = 'none';
    }
    
    productModal.show();
  }
  
  // Handler untuk tombol Detail/Beli
  document.querySelectorAll('#homePage .btn-detail').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      
      const parent = this.closest('[data-name]');
      if (parent) {
        const productData = {
          name: parent.dataset.name,
          category: parent.dataset.category,
          price: parent.dataset.price,
          image: parent.dataset.image,
          desc: parent.dataset.desc || '',
          spesifikasi: parent.dataset.spesifikasi || ''
        };
        
        showProductModal(productData);
      }
    });
  });
  
  // Handler untuk klik pada card produk
  document.querySelectorAll('#homePage .product-card').forEach(card => {
    card.addEventListener('click', function(e) {
      if (e.target.closest('.btn-detail')) return;
      
      const productData = {
        name: this.dataset.name,
        category: this.dataset.category,
        price: this.dataset.price,
        image: this.dataset.image,
        desc: this.dataset.desc || '',
        spesifikasi: this.dataset.spesifikasi || ''
      };
      
      showProductModal(productData);
    });
  });
  
  // Handler untuk tombol Order WhatsApp di modal
  document.getElementById('btnOrderWA').addEventListener('click', function() {
    if (currentProductData) {
      let priceText = '';
      if (currentProductData.price.includes('-')) {
        priceText = 'Rp ' + currentProductData.price;
      } else {
        priceText = 'Rp ' + parseInt(currentProductData.price).toLocaleString('id-ID');
      }
      
      let message = `Halo, saya tertarik dengan produk:\n\n` +
                   `Nama: ${currentProductData.name}\n` +
                   `Kategori: ${currentProductData.category}\n` +
                   `Harga: ${priceText}\n`;
      
      if (currentProductData.spesifikasi) {
        message += `Motor: ${currentProductData.spesifikasi}\n`;
      }
      
      message += `\nApakah produk ini tersedia?`;
      
      const waUrl = `https://wa.me/6285738506679?text=${encodeURIComponent(message)}`;
      window.open(waUrl, '_blank');
    }
  });
});
</script>

{% endblock %}